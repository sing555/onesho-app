<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ぴかぴかモーニング - トイレきろく</title>
    <meta name="description" content="4歳の男の子のためのトイレ記録アプリ。楽しく記録して、おねしょを卒業しよう！">

    <!-- PWA Settings -->
    <meta name="theme-color" content="#72c6ef">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- Styles & Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@400;500&family=Outfit:wght@400;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>

<body>
    <header>
        <h1>☀️ ぴかぴかモーニング ☀️</h1>
    </header>

    <div class="main-container">
        <!-- 記録入力フォーム -->
        <section class="today-card">
            <h2>きろくする</h2>

            <div class="form-group">
                <label>ひにち</label>
                <input type="date" id="input-date" class="modern-input">
            </div>

            <div class="form-group">
                <label>じかん</label>
                <input type="time" id="input-time" class="modern-input">
            </div>

            <div class="form-group">
                <label>おしっこしたくなっていた？</label>
                <div class="btn-toggle-group" id="urge-toggle">
                    <button class="toggle-btn active" data-value="yes">あった！</button>
                    <button class="toggle-btn" data-value="no">なかった</button>
                </div>
            </div>

            <div class="form-group">
                <label>どうだった？</label>
                <div class="btn-toggle-group" id="status-toggle">
                    <button class="toggle-btn active" data-value="success">☀️ できた！</button>
                    <button class="toggle-btn" data-value="fail">☁️ もれた...</button>
                </div>
            </div>

            <div class="form-group">
                <label>量は？</label>
                <div class="btn-toggle-group" id="amount-toggle">
                    <button class="toggle-btn" data-value="small">すくない</button>
                    <button class="toggle-btn active" data-value="medium">ふつう</button>
                    <button class="toggle-btn" data-value="large">おおい</button>
                </div>
            </div>

            <div class="form-group">
                <label>メモ</label>
                <input type="text" id="input-comment" placeholder="ひとことメモ" class="modern-input">
            </div>

            <button class="submit-btn" id="btn-save">きろくをのこす！</button>
        </section>

        <!-- 履歴 -->
        <section class="history-card">
            <h3><span id="log-date-label">きょう</span>の ログ</h3>
            <div id="log-list" class="log-list">
                <!-- JSで追加 -->
            </div>
        </section>

        <!-- ごほうびカウンター -->
        <section class="reward-card">
            <div>こんげつの ぴかぴか</div>
            <div class="reward-count" id="success-count">0</div>
            <div>かい ！！</div>
        </section>

        <!-- カレンダー -->
        <section class="calendar-card">
            <div class="calendar-header">
                <button id="prev-month">◀</button>
                <h3 id="calendar-title">2024年1月</h3>
                <button id="next-month">▶</button>
            </div>
            <div class="calendar-grid" id="calendar-grid">
                <!-- JSで生成 -->
            </div>
        </section>
    </div>

    <script>
        // Service Workerの登録と更新検知
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('SW registered:', registration);

                    // 新しいService Workerがインストールされた時に通知
                    registration.onupdatefound = () => {
                        const installingWorker = registration.installing;
                        installingWorker.onstatechange = () => {
                            if (installingWorker.state === 'installed') {
                                if (navigator.serviceWorker.controller) {
                                    // 新しいバージョンがある場合
                                    console.log('New content is available; please refresh.');
                                    // ユーザーに知らせるか、自動でリロード
                                    if (confirm('新しいバージョンがあります。更新しますか？')) {
                                        location.reload();
                                    }
                                }
                            }
                        };
                    };
                }).catch(error => {
                    console.error('SW registration failed:', error);
                });
            });

            // Service Workerが入れ替わった時に発火
            let refreshing = false;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!refreshing) {
                    refreshing = true;
                    window.location.reload();
                }
            });
        }
    </script>
    <script src="app.js"></script>
</body>

</html>